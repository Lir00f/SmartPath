"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const sequelize_1 = require("sequelize");
class SequelizeFactory {
    static build(sequelizeCtorOptions, stopCallback) {
        const sequelize = sequelizeCtorOptions.length === 1
            ? new sequelize_1.Sequelize(sequelizeCtorOptions[0])
            : new sequelize_1.Sequelize(sequelizeCtorOptions[0], sequelizeCtorOptions[1]);
        this.overrideCloseMethod(sequelize, stopCallback);
        return sequelize;
    }
    static overrideCloseMethod(sequelize, stopCallback) {
        // override close method to ensure to execute the stop
        sequelize.close = async function close() {
            try {
                await sequelize_1.Sequelize.prototype.close.call(this);
            }
            finally {
                if (stopCallback)
                    await stopCallback();
            }
        };
    }
}
exports.default = SequelizeFactory;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VxdWVsaXplLWZhY3RvcnkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvY29ubmVjdGlvbi9zZXF1ZWxpemUtZmFjdG9yeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHlDQUFzQztBQUt0QyxNQUFxQixnQkFBZ0I7SUFDbkMsTUFBTSxDQUFDLEtBQUssQ0FDVixvQkFBcUUsRUFDckUsWUFBOEI7UUFFOUIsTUFBTSxTQUFTLEdBQ2Isb0JBQW9CLENBQUMsTUFBTSxLQUFLLENBQUM7WUFDL0IsQ0FBQyxDQUFDLElBQUkscUJBQVMsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN4QyxDQUFDLENBQUMsSUFBSSxxQkFBUyxDQUFDLG9CQUFvQixDQUFDLENBQUMsQ0FBQyxFQUFFLG9CQUFvQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFdEUsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFNBQVMsRUFBRSxZQUFZLENBQUMsQ0FBQztRQUVsRCxPQUFPLFNBQVMsQ0FBQztJQUNuQixDQUFDO0lBRU8sTUFBTSxDQUFDLG1CQUFtQixDQUFDLFNBQW9CLEVBQUUsWUFBOEI7UUFDckYsc0RBQXNEO1FBQ3RELFNBQVMsQ0FBQyxLQUFLLEdBQUcsS0FBSyxVQUFVLEtBQUs7WUFDcEMsSUFBSTtnQkFDRixNQUFNLHFCQUFTLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDNUM7b0JBQVM7Z0JBQ1IsSUFBSSxZQUFZO29CQUFFLE1BQU0sWUFBWSxFQUFFLENBQUM7YUFDeEM7UUFDSCxDQUFDLENBQUM7SUFDSixDQUFDO0NBQ0Y7QUF6QkQsbUNBeUJDIn0=