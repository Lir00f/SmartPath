"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const errors_1 = require("./errors");
/** Test connection. If this doesn't resolve after 10s, throw a timeout error */
async function testConnectionWithTimeOut(sequelize, databaseUri, timeout = 10000) {
    let timeoutId;
    const timeoutPromise = new Promise((resolve, reject) => {
        timeoutId = setTimeout(() => {
            reject(new errors_1.DatabaseConnectError('Connection to database timed out', databaseUri));
        }, timeout);
    });
    await Promise.race([
        sequelize.authenticate()?.finally(() => {
            clearTimeout(timeoutId);
        }),
        timeoutPromise,
    ]);
}
exports.default = testConnectionWithTimeOut;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29ubmVjdGlvbi10ZXN0ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvY29ubmVjdGlvbi9jb25uZWN0aW9uLXRlc3Rlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUVBLHFDQUFnRDtBQUVoRCxnRkFBZ0Y7QUFDakUsS0FBSyxVQUFVLHlCQUF5QixDQUNyRCxTQUFvQixFQUNwQixXQUFtQixFQUNuQixPQUFPLEdBQUcsS0FBSztJQUVmLElBQUksU0FBUyxDQUFDO0lBRWQsTUFBTSxjQUFjLEdBQUcsSUFBSSxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLEVBQUU7UUFDckQsU0FBUyxHQUFHLFVBQVUsQ0FBQyxHQUFHLEVBQUU7WUFDMUIsTUFBTSxDQUFDLElBQUksNkJBQW9CLENBQUMsa0NBQWtDLEVBQUUsV0FBVyxDQUFDLENBQUMsQ0FBQztRQUNwRixDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDZCxDQUFDLENBQUMsQ0FBQztJQUVILE1BQU0sT0FBTyxDQUFDLElBQUksQ0FBQztRQUNqQixTQUFTLENBQUMsWUFBWSxFQUFFLEVBQUUsT0FBTyxDQUFDLEdBQUcsRUFBRTtZQUNyQyxZQUFZLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDMUIsQ0FBQyxDQUFDO1FBQ0YsY0FBYztLQUNmLENBQUMsQ0FBQztBQUNMLENBQUM7QUFuQkQsNENBbUJDIn0=